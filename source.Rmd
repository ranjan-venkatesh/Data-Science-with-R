---
title: "R Notebook"
output: html_notebook
---

*1. Data Cleaning*
- reads police_incidents.csv and loads only required attributes into a dataframe object
```{r}
library(tibble)
library(dplyr)
library(readr)
#Uncomment below import line only when running the script for first time, to avoid multiple time download of 400+Mb sized dataset
#dallas_incidents<-read_csv('https://www.dropbox.com/s/7ldxwrsyd10zx95/Police_Incidents.csv?dl=1')
#as_tibble(dallas_incidents)
dallas=select(dallas_incidents,1,3,5,6,7,9,13,14,15,38,43,44,46,47,48,50,53,54,69,75,76,78,89,95,96,97)
as_tibble(dallas)
```
*2. Data Pre-processing*
- transforms the attribute 'call received date time' string to R datetime object and sort them in ascending order  
- compute a new attribute 'week of the day'(name of the weekday, incident occured viz Mon,Tue and so on) and 'rounded time'(Hours being rounded off to closest value and only hour value is extracted from the rounded date) from 'call recieved date time'
- transform values of 'rounded time' to four ordinal values and compute 'time slot of occurence' attribute.
```{r}
library(lubridate)
library(magrittr)
library(dplyr)
time_slot_vec=seq(0,24,6)
labels_vec=c("0-6","7-12","13-18","19-23")
dallas%<>%
  mutate(`Call Received Date Time`=as_datetime(mdy_hms(`Call Received Date Time`)))%>%
  arrange(`Call Received Date Time`)%>%
  mutate(`week of the day`=wday(`Call Received Date Time`),`rounded time`=hour(round_date(`Call Received Date Time`,"hour")))%>%
  mutate(`time slot of occurence`=cut(`rounded time`,breaks = time_slot_vec,labels = labels_vec,include.lowest = TRUE))

#anyDuplicated(dallas$`Service Number ID`)
#unique(dallas$)

```
*3. Exploratory Analysis / Visualizations*
3.1 What crimes are frequent?
```{r}
library(ggplot2)
library(forcats)
dallas%>%
  filter(!is.na(`NIBRS Crime Category`))%>%
  ggplot(aes(fct_infreq(`NIBRS Crime Category`),fill=`NIBRS Crime Category`))+geom_bar(position = "stack") +  labs(title="Crime Categories Frequency", subtitle="count for every kind of crime that occured", y="Frequency", x="Crime") + coord_flip() + theme(legend.position="none")

```
3.2 How Gender and the time of crime are related and volume of crime for each time slot. 
```{r}
library(ggplot2)
library(forcats)
dallas%>%
filter(!is.na(`Victim Gender`) & (`Victim Gender`=="Male" | `Victim Gender`=="Female") & !is.na(`time slot of occurence`))%>%
ggplot(aes(fct_infreq(`Victim Gender`), fill = `time slot of occurence`) ) +
  geom_bar(position = "stack")

```
3.3 How crimes relate to the time of day 
```{r}
library(ggplot2)
library(scales)
library(forcats)
dallas%>%
filter(!is.na(`NIBRS Crime Category`) & !is.na(`time slot of occurence`))%>%
ggplot(aes(fct_infreq(`NIBRS Crime Category`), fill = `time slot of occurence`)) +geom_bar(position = "stack")+coord_flip()
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
